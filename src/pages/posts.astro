---
import Layout from "../layouts/Layout.astro";
import PatternBackground from "../components/PatternBackground.astro";
import Tag from "../components/Tag.astro";
import { Icon } from "astro-icon/components";
import { getAllPosts } from "../data/posts";

const posts = await getAllPosts();
posts.sort(
    (a, b) => new Date(b.published).getTime() - new Date(a.published).getTime(),
);
---

<Layout>
    <h1 class="text-center text-4xl font-bold my-8">Posts</h1>

    <div class="flex flex-col items-center gap-8 px-4 lg:px-20 pb-20">
        {
            posts.map((post) => (
                <a
                    href={post.link}
                    class="flex flex-col max-w-xl md:max-w-3xl lg:max-w-5xl w-full transition-colors duration-300 hover:bg-black/20 rounded-lg p-4 bg-black/5"
                >
                    <div class="overflow-hidden rounded-lg bg-black">
                        {post.preview ? (
                            <img
                                src={post.preview}
                                alt="Post preview"
                                loading="lazy"
                                class="h-48 lg:h-64 w-full object-contain drop-shadow-lg"
                            />
                        ) : (
                            <div class="h-48 lg:h-64 w-full bg-white dark:bg-black drop-shadow-lg relative">
                                <PatternBackground />
                            </div>
                        )}
                    </div>

                    <div class="p-4 md:p-6">
                        <h2
                            class="font-bold text-2xl mb-2"
                            transition:name={`post-title-${post.filename}`}
                        >
                            {post.title}
                        </h2>
                        <div
                            class="flex flex-wrap items-center gap-4 mb-3 text-sm"
                            transition:name={`post-meta-${post.filename}`}
                        >
                            <div class="flex flex-wrap items-center gap-4 text-gray-500">
                                <span>
                                    {new Date(
                                        post.published,
                                    ).toLocaleDateString("en-US", {
                                        year: "numeric",
                                        month: "short",
                                        day: "numeric",
                                    })}
                                </span>
                                <span class="flex items-center gap-1">
                                    <Icon
                                        class="inline size-4"
                                        name="mdi:clock-outline"
                                    />
                                    {post.minutesToRead} min
                                </span>
                            </div>
                            {post.tags && (
                                <div class="flex flex-wrap gap-2">
                                    {post.tags.map((tag) => (
                                        <Tag text={tag} />
                                    ))}
                                </div>
                            )}
                        </div>
                        <p class="text-lg">{post.desc}</p>
                    </div>
                </a>
            ))
        }
    </div>
</Layout>
